<UserControl x:Class="FanTuner.UI.Views.SettingsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             mc:Ignorable="d"
             d:DesignHeight="600" d:DesignWidth="800">

    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel>
            <!-- Header -->
            <Grid Margin="0,0,0,24">
                <TextBlock Text="Settings" Style="{StaticResource HeaderText}"/>
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                    <Button Content="Reset Defaults"
                            Style="{StaticResource SecondaryButton}"
                            Command="{Binding ResetToDefaultsCommand}"
                            Margin="0,0,8,0"/>
                    <Button Content="Save"
                            Style="{StaticResource PrimaryButton}"
                            Command="{Binding SaveSettingsCommand}"/>
                </StackPanel>
            </Grid>

            <!-- Unsaved Changes Warning -->
            <Border Style="{StaticResource WarningBanner}"
                    Visibility="{Binding HasUnsavedChanges, Converter={StaticResource BoolToVisibilityConverter}}">
                <TextBlock Text="You have unsaved changes." Foreground="{StaticResource WarningBrush}"/>
            </Border>

            <!-- General Settings -->
            <TextBlock Text="General" Style="{StaticResource SubheaderText}" Margin="0,0,0,12"/>
            <Border Style="{StaticResource CardStyle}" Margin="0,0,0,24">
                <StackPanel>
                    <Grid Margin="0,0,0,16">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="200"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Text="Poll Interval" VerticalAlignment="Center"/>
                        <ComboBox Grid.Column="1"
                                  ItemsSource="{Binding AvailablePollIntervals}"
                                  SelectedValue="{Binding PollIntervalMs}"
                                  Width="150" HorizontalAlignment="Left">
                            <ComboBox.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock>
                                        <TextBlock.Text>
                                            <Binding StringFormat="{}{0} ms"/>
                                        </TextBlock.Text>
                                    </TextBlock>
                                </DataTemplate>
                            </ComboBox.ItemTemplate>
                        </ComboBox>
                    </Grid>

                    <Grid Margin="0,0,0,16">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="200"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Text="Theme" VerticalAlignment="Center"/>
                        <ComboBox Grid.Column="1"
                                  ItemsSource="{Binding AvailableThemes}"
                                  SelectedValue="{Binding Theme}"
                                  Width="150" HorizontalAlignment="Left"/>
                    </Grid>

                    <CheckBox Content="Start minimized"
                              IsChecked="{Binding StartMinimized}"
                              Margin="0,0,0,8"/>

                    <CheckBox Content="Minimize to tray instead of closing"
                              IsChecked="{Binding MinimizeToTray}"/>
                </StackPanel>
            </Border>

            <!-- Safety Settings -->
            <TextBlock Text="Safety" Style="{StaticResource SubheaderText}" Margin="0,0,0,12"/>
            <Border Style="{StaticResource CardStyle}" Margin="0,0,0,24">
                <StackPanel>
                    <TextBlock Text="Emergency mode activates when temperatures exceed these thresholds. All fans will be set to 100%."
                               Style="{StaticResource BodyText}" TextWrapping="Wrap" Margin="0,0,0,16"/>

                    <Grid Margin="0,0,0,16">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="200"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Text="CPU Emergency Temp" VerticalAlignment="Center"/>
                        <StackPanel Grid.Column="1" Orientation="Horizontal">
                            <TextBox Text="{Binding EmergencyCpuTemp, UpdateSourceTrigger=PropertyChanged}"
                                     Width="80"/>
                            <TextBlock Text="°C" VerticalAlignment="Center" Margin="8,0,0,0"/>
                        </StackPanel>
                    </Grid>

                    <Grid Margin="0,0,0,16">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="200"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Text="GPU Emergency Temp" VerticalAlignment="Center"/>
                        <StackPanel Grid.Column="1" Orientation="Horizontal">
                            <TextBox Text="{Binding EmergencyGpuTemp, UpdateSourceTrigger=PropertyChanged}"
                                     Width="80"/>
                            <TextBlock Text="°C" VerticalAlignment="Center" Margin="8,0,0,0"/>
                        </StackPanel>
                    </Grid>

                    <Grid Margin="0,0,0,16">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="200"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Text="Hysteresis" VerticalAlignment="Center"/>
                        <StackPanel Grid.Column="1" Orientation="Horizontal">
                            <TextBox Text="{Binding EmergencyHysteresis, UpdateSourceTrigger=PropertyChanged}"
                                     Width="80"/>
                            <TextBlock Text="°C (temp drop before exiting emergency mode)"
                                       VerticalAlignment="Center" Margin="8,0,0,0"
                                       Foreground="{StaticResource TextMutedBrush}"/>
                        </StackPanel>
                    </Grid>

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="200"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Text="Minimum Fan Speed" VerticalAlignment="Center"/>
                        <StackPanel Grid.Column="1" Orientation="Horizontal">
                            <TextBox Text="{Binding DefaultMinFanPercent, UpdateSourceTrigger=PropertyChanged}"
                                     Width="80"/>
                            <TextBlock Text="% (prevents fan stall)"
                                       VerticalAlignment="Center" Margin="8,0,0,0"
                                       Foreground="{StaticResource TextMutedBrush}"/>
                        </StackPanel>
                    </Grid>
                </StackPanel>
            </Border>

            <!-- Logging Settings -->
            <TextBlock Text="Logging" Style="{StaticResource SubheaderText}" Margin="0,0,0,12"/>
            <Border Style="{StaticResource CardStyle}" Margin="0,0,0,24">
                <StackPanel>
                    <CheckBox Content="Enable file logging"
                              IsChecked="{Binding EnableFileLogging}"
                              Margin="0,0,0,16"/>

                    <Grid Margin="0,0,0,16">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="200"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Text="Log Level" VerticalAlignment="Center"/>
                        <ComboBox Grid.Column="1"
                                  ItemsSource="{Binding AvailableLogLevels}"
                                  SelectedValue="{Binding LogLevel}"
                                  Width="150" HorizontalAlignment="Left"/>
                    </Grid>

                    <StackPanel Orientation="Horizontal">
                        <Button Content="Open Log Folder"
                                Style="{StaticResource SecondaryButton}"
                                Command="{Binding OpenLogFolderCommand}"
                                Margin="0,0,8,0"/>
                        <Button Content="Open Config Folder"
                                Style="{StaticResource SecondaryButton}"
                                Command="{Binding OpenConfigFolderCommand}"/>
                    </StackPanel>
                </StackPanel>
            </Border>

            <!-- Service Status -->
            <TextBlock Text="Service Status" Style="{StaticResource SubheaderText}" Margin="0,0,0,12"/>
            <Border Style="{StaticResource CardStyle}" Margin="0,0,0,24">
                <StackPanel>
                    <Grid Margin="0,0,0,8">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="150"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Text="Status"/>
                        <StackPanel Grid.Column="1" Orientation="Horizontal">
                            <Ellipse Width="10" Height="10" Margin="0,0,8,0">
                                <Ellipse.Style>
                                    <Style TargetType="Ellipse">
                                        <Setter Property="Fill" Value="{StaticResource ErrorBrush}"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsServiceRunning}" Value="True">
                                                <Setter Property="Fill" Value="{StaticResource SuccessBrush}"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Ellipse.Style>
                            </Ellipse>
                            <TextBlock>
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Text" Value="Stopped"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsServiceRunning}" Value="True">
                                                <Setter Property="Text" Value="Running"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                        </StackPanel>
                    </Grid>

                    <Grid Margin="0,0,0,8">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="150"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Text="Version"/>
                        <TextBlock Grid.Column="1" Text="{Binding ServiceVersion}"/>
                    </Grid>

                    <Grid Margin="0,0,0,16">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="150"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Text="Uptime"/>
                        <TextBlock Grid.Column="1">
                            <TextBlock.Text>
                                <Binding Path="ServiceUptime" StringFormat="{}{0} seconds"/>
                            </TextBlock.Text>
                        </TextBlock>
                    </Grid>

                    <Button Content="Refresh Status"
                            Style="{StaticResource SecondaryButton}"
                            Command="{Binding RefreshServiceStatusCommand}"
                            HorizontalAlignment="Left"/>
                </StackPanel>
            </Border>

            <!-- About -->
            <TextBlock Text="About" Style="{StaticResource SubheaderText}" Margin="0,0,0,12"/>
            <Border Style="{StaticResource CardStyle}">
                <StackPanel>
                    <TextBlock Text="FanTuner - PC Fan Control" FontWeight="Bold" Margin="0,0,0,4"/>
                    <TextBlock Text="Version 1.0.0" Foreground="{StaticResource TextSecondaryBrush}" Margin="0,0,0,8"/>
                    <TextBlock TextWrapping="Wrap" Foreground="{StaticResource TextMutedBrush}">
                        Fan control application using LibreHardwareMonitor for hardware access.
                        Some hardware may be monitor-only depending on manufacturer support.
                    </TextBlock>
                </StackPanel>
            </Border>
        </StackPanel>
    </ScrollViewer>
</UserControl>
